---
import AvatarGroup from '../common/Avatar/AvatarGroup';
import Avatar from '../common/Avatar/Avatar';
import HeaderBar from '../common/header/HeaderBar.astro';
import { Heart, Download } from 'lucide-react';
import { LikeButton } from '../common/button/LikeButton';
import { formatDate } from '../../lib/dateFormat';

const { t, lang, project, userContext } = Astro.props;

// Decompose project
const projectId = project?.projectId || '';
const projectTitle = project?.title || 'Untitled Project';
const projectPreviewImageUrl = project?.previewImageUrl || '/default-image.jpg';
const projectCategories = project?.categories || [];
const contributors = project?.contributors || [];
const likeCount = project?.likeCount || 0;
const createdAt = formatDate(project?.createdAt || 'Unknown date');

// Decompose user data
const { userLiked } = userContext;
---

<section id="HeroProjectDetail" class="flex w-full flex-col gap-4 pt-30 py-6 px-[150px]">
  <!-- Project metadata -->

  <!-- Project image -->
  <div class="w-full h-[300px] my-4">
    <a href={`/${lang}/project/${project.slug}`}>
      <img
        src={projectPreviewImageUrl}
        alt={projectTitle}
        class="w-full h-full object-cover rounded-xl hover:opacity-90 transition"
        loading="lazy"
      />
    </a>
  </div>

  <!-- Project title -->
  <h2>{projectTitle}</h2>

  <!-- Project categories -->
  <div class="flex gap-1 flex-wrap">
    {projectCategories.map((category : any) => (
<<<<<<< HEAD
      <button class="btn-locked detail">
=======
      <button class="btn-locked detail ">
>>>>>>> 15cc28596eafd404af0b0b7247895ea35f32b13c
        {category.categoryName}
      </button>
    ))}
  </div>

  <!-- Contributor and buttons container -->
  <div class="flex justify-between items-center">
    <!-- Contributor information -->
    <div class="flex flex-col gap-2">
      <!-- Publisher avatar -->
      <div class="flex items-center gap-4">
        <Avatar
          client:load
          name={contributors[0].fullname}
          avatar={contributors[0].profileImageUrl}
        />
        <div class="text-supporting-ghost">
          <span class="small">{contributors[0].fullname}</span>
          <span class="detail"> | {createdAt}</span>
        </div>
      </div>

      <!-- Contributor avatars -->
      <div class="flex items-center gap-4">
        <AvatarGroup
          client:load
          contributors={contributors}
          className="w-6 h-6 -space-x-7"
        />
      </div>
    </div>

    <!-- Action buttons -->
    <div class="flex gap-2">
        <!-- Like button -->
        <LikeButton
          client:load
          projectId={projectId}
          initialLikes={likeCount}
          initialLiked={userLiked}
        />

        <!-- Download button -->
        <button class="btn-primary">
            <Download className='text-main-white w-5 h-5'/>
            <span class="small text-main-white">Download Project Resource</span> 
        </button>
    </div>
  </div>
</section>