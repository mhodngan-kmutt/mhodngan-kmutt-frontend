---
import { getProjects, getProjectBySlug } from '../../../lib/api';
import ContributorAvatars from '@/components/common/ContributorAvatars';
import { Heart, Eye } from 'lucide-react';

const { slug, lang } = Astro.params as { slug: string; lang: string };

// Required for dynamic routes in Astro
export async function getStaticPaths() {
  const projects = await getProjects();
  const languages = ['en', 'th'];

  return projects.flatMap((project) =>
    languages.map((lang) => ({
      params: {
        slug: project.slug, // ต้องมี slug จริง
        lang,
      },
    }))
  );
}

// Fetch project by slug
const project = await getProjectBySlug(slug);
---

<a href={`/${lang}/project`} class="text-sm text-blue-600 mb-4 inline-block">← Back to Projects</a>

<div class="max-w-4xl mx-auto flex flex-col gap-6">
  <!-- Project Card -->
  <div class="w-full flex flex-col gap-3 p-4 rounded-xl bg-white shadow-lg">
    <div class="relative h-[300px] w-full rounded-xl overflow-hidden">
      <img
        src={project.image}
        alt={project.title}
        class="absolute inset-0 w-full h-full object-cover object-top rounded-xl transition duration-300 hover:scale-105"
        loading="lazy"
      />
    </div>

    <h1 class="text-2xl font-bold">{project.title}</h1>
    <p class="text-gray-600">{project.description}</p>

    <div class="flex items-center gap-6">
      <div class="flex items-center gap-2">
        <Heart className="w-5 h-5 text-orange-400" />
        <span>{project.likes}</span>
      </div>
      <div class="flex items-center gap-2">
        <Eye className="w-5 h-5 text-orange-400" />
        <span>{project.views}</span>
      </div>
    </div>

    <div class="flex gap-6 items-center">
      <div>
        <div class="text-sm font-medium text-gray-500">Team</div>
        <div class="text-gray-700">{project.team}</div>
      </div>
      <div>
        <div class="text-sm font-medium text-gray-500">Contributors</div>
        <ContributorAvatars client:load contributors={project.Contributor} />
      </div>
      <div>
        <div class="text-sm font-medium text-gray-500">Professors</div>
        <ContributorAvatars client:load contributors={project.Professors} />
      </div>
    </div>
  </div>
</div>
