---
export const prerender = false;
import Layout from '../../../layouts/Layout.astro';
import HeaderBar from '../../../components/common/header/HeaderBar.astro';
import { ProjectListWrapper } from '../../../components/project/ProjectListWrapper';
import i18n from '../../../i18n/i18n';
import { getProjects } from '../../../lib/api';

// dynamic paths
export async function getStaticPaths() {
  const languages = ['en', 'th'];
  return languages.map((lang) => ({
    params: { lang },
  }));
}

// get params and query
const { lang } = Astro.params;
const currentLang = lang === 'th' ? 'th' : 'en';
i18n.changeLanguage(currentLang);
const t = i18n.t.bind(i18n);

const q = Astro.url.searchParams.get('q') || undefined;
const badge = Astro.url.searchParams.get('badge') || undefined;
const status = Astro.url.searchParams.get('status') || undefined;
const from = Astro.url.searchParams.get('from') || undefined;
const to = Astro.url.searchParams.get('to') || undefined;
const contributors = Astro.url.searchParams.get('contributors') || undefined;

const orderBy = q
  ? 'like_count'
  : (Astro.url.searchParams.get('orderBy') as
      | 'created_at'
      | 'updated_at'
      | 'title'
      | 'like_count'
      | 'view_count'
      | 'monthly_like_count'
      | 'monthly_view_count'
      | 'yearly_like_count'
      | 'yearly_view_count') || 'updated_at';

const order = (Astro.url.searchParams.get('order') as 'asc' | 'desc') || 'desc';

const { meta, data: projects } = await getProjects({
  q,
  badge,
  status,
  from,
  to,
  contributors,
  orderBy,
  order,
});
---

<Layout title={t('header.explore')} class="overflow-y-scroll">
  <HeaderBar t={t} lang={lang} />
  <section class="flex w-full flex-col pt-30 py-6 px-[var(--padding-md)] gap-10">
    <ProjectListWrapper 
      client:load 
      initialProjects={projects} 
      lang={currentLang} 
      translations={{
        certified: t('card.certified'),
        contributors: t('card.contributors')
      }}
      searchQuery={q} 
    />
  </section>
</Layout>


